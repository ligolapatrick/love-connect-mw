<!DOCTYPE html>
<html lang="en">
<head>
  <link rel="icon" type="image/png" sizes="192x192" href="images/logo.png">
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta name="google-site-verification" content="tsUpn5M52vhhE7CcFHCjRL7dpZb2AOWk8JnmXFLR744" />
  <title>Find One by Click</title>
  <link rel="stylesheet" href="styles21.css">
</head>
<body>
   
      <!-- Loading Indicator HTML -->
<div class="loading-container" id="loadingIndicator">
  <img src="images/logo.png" alt="Loading" class="loading-logo">
</div>

  <nav>
   
  </nav>
  <hr>
  <h1>Welcome to Find One by Click</h1>
  <header>
    <div class="top-right"></div>
    <a href="/searching" class="nav-item">click to search for people anywhere</a>
    <p id="user-welcome">Welcome, <span id="username"></span>!</p>
    <div class="dropdown-menu" id="dropdown-menu">
      <a href="searching-base.html">searching</a> |
  </div>
  </header>
  <main>
  </div>
  <main class="dashboard">
    <div class="left-side">
      <section class="category">
        <div class="category-header">
          <h2>Near-You</h2>
        </div>
        <div class="single-card">
          <div class="user-card">
            <a href="nearby-users"><img src="images/Matches.jpg" alt="User 1"></a>
          </div>
        </div>
      </section>
    </div>
    
    <div class="right-side">
      <section class="category">
        <div class="category-header">
          <h2>Hangout</h2>
        </div>
        <div class="single-card">
          <div class="user-card">
            <a href="voice-chat-room"><img src="images/hookup.jpeg" alt="User 2"></a>
          </div>
        </div>
      </section>
    </div>
  </main>

  <main class="dashboard">
    <div class="left-side">
      <section class="category">
        <div class="category-header">
          <h2>instant-date</h2>
        </div>
        <div class="single-card">
          <div class="user-card">
            <a href="instantdate.html"><img src="images/friend-requests.jpg" alt="User 1"></a>
          </div>
        </div>
      </section>
    </div>
    
    <div class="right-side">
      <section class="category">
        <div class="category-header">
          <h2>Mood Matcher</h2>
        </div>
        <div class="single-card">
          <div class="user-card">
            <a href="moodmatcher"><img src="images/LoveConnect calendar and messaging icon.png" alt="User 2"></a>
          </div>
        </div>
      </section>
    </div>
  </main>

  <main class="dashboard">
    <div class="left-side">
      <section class="category">
        <div class="category-header">
          <h2>Location Match</h2>
        </div>
        <div class="single-card">
          <div class="user-card">
            <a href="location-matches"><img src="images/Profile Verification.jpg" alt="User 1"></a>
          </div>
        </div>
      </section>
    </div>
    
    <div class="right-side">
      <section class="category">
        <div class="category-header">
          <h2>Coffee-Room</h2>
        </div>
        <div class="single-card">
          <div class="user-card">
            <a href="coffee-room.html"><img src="images/Coffee Room.jpg" alt="User 2"></a>
          </div>
        </div>
      </section>
    </div>
  </main>

  <main class="dashboard">
  <div class="left-side">
    <section class="category">
      <div class="category-header">
        <h2>Maritual Goals</h2>
      </div>
      <div class="single-card">
        <div class="user-card">
          <a href="relationship-goals"><img src="images/loveconect dating app images.png" alt="User 1"></a>
        </div>
      </div>
    </section>
  </div>
  
  <div class="right-side">
    <section class="category">
      <div class="category-header">
        <h2>quick match</h2>
      </div>
      <div class="single-card">
        <div class="user-card">
          <a href="quick-matches.html"><img src="images/about.jpg" alt="User 2"></a>
        </div>
      </div>
    </section>
  </div>
</main>

<main class="dashboard">
  <div class="left-side">
    <section class="category">
      <div class="category-header">
        <h2>location search</h2>
      </div>
      <div class="single-card">
        <div class="user-card">
          <a href="location-based-search.html"><img src="images/Advanced Search.jpg" alt="User 1"></a>
        </div>
      </div>
    </section>
  </div>
  
  <div class="right-side">
    <section class="category">
      <div class="category-header">
        <h2>Based  match</h2>
      </div>
      <div class="single-card">
        <div class="user-card">
          <a href="potential-matches"><img src="images/Events and Meetups.jpg" alt="User 2"></a>
        </div>
      </div>
    </section>
  </div>
</main>

<nav class="bottom-nav">
  <a href="/chatlist"><img src="icons/message.png" alt="Messages"> Messages 
    <span id="unreadCount" class="unread-count"></span>
</a>
  <a href="/profile"><img src="icons/profile.png" alt="Profile"> Profile</a>
  <a href="/matches"><img src="icons/matches.png" alt="Matches"> Matches</a>
  <a href="/speed"><img src="icons/speed.png" alt="Speed"> Speed</a>
  <a href="/notifications"><img src="icons/notification.png" alt="Notification"> Notification</a>
</nav>
  
  <footer>
    <p>&copy; 2025 LoveConnect. All rights reserved.</p>
    <p><a href="privacy-policy.html">Privacy Policy</a> | <a href="terms-of-service.html">Terms of Service</a></p>
  </footer>

  <!-- Notification Modal -->
  <div id="notification-modal" class="modal">
    <div class="modal-content">
      <span class="close">&times;</span>
      <p>Welcome to LoveConnect! It seems like you're not registered. Please click the Register button if you don't have an account or the Login button if you are already registered. if you are already logged in ignore this message and continue enjoying the website!!</p>
      <button id="register-button" onclick="window.location.href='registration.html'">Register</button>
      <button id="login-button" onclick="window.location.href='logout'">Login</button>
    </div>
  </div>
 
  <script>
    async function checkUserRegistration() {
      try {
        const response = await fetch('/api/check-registration', {
          method: 'GET',
          credentials: 'include'
        });
        const result = await response.json();
        return result.isRegistered;
      } catch (error) {
        console.error('Error checking registration status:', error);
        return false; // Default to not registered in case of error
      }
    }

    document.addEventListener('DOMContentLoaded', async function() {
      const isRegistered = await checkUserRegistration();
      if (!isRegistered) {
        const modal = document.getElementById('notification-modal');
        modal.style.display = 'block';

        const closeModal = document.getElementsByClassName('close')[0];
        closeModal.onclick = function() {
          modal.style.display = 'none';
        };

        window.onclick = function(event) {
          if (event.target === modal) {
            modal.style.display = 'none';
          }
        };
      }
    });

    if ('serviceWorker' in navigator && 'PushManager' in window) {
    navigator.serviceWorker.register('/service-worker.js')
      .then(function(registration) {
        console.log('Service Worker registered with scope:', registration.scope);

        return fetch('/vapidPublicKey')
          .then(response => response.text())
          .then(function(vapidPublicKey) {
            return registration.pushManager.subscribe({
              userVisibleOnly: true,
              applicationServerKey: urlBase64ToUint8Array(vapidPublicKey)
            });
          });
      })
      .then(function(subscription) {
        console.log('User is subscribed:', subscription);

        return fetch('/subscribe', {
          method: 'POST',
          headers: {
            'Content-Type': 'application/json'
          },
          body: JSON.stringify(subscription)
        });
      })
      .catch(function(error) {
        console.error('Service Worker registration or subscription failed:', error);
      });
  } else {
    console.warn('Push messaging is not supported.');
  }

  function urlBase64ToUint8Array(base64String) {
    const padding = '='.repeat((4 - base64String.length % 4) % 4);
    const base64 = (base64String + padding)
      .replace(/-/g, '+')
      .replace(/_/g, '/');

    const rawData = window.atob(base64);
    const outputArray = new Uint8Array(rawData.length);

    for (let i = 0; i < rawData.length; ++i) {
      outputArray[i] = rawData.charCodeAt(i);
    }
    return outputArray;
  }


    // Function to fetch and update the unread message count
    function fetchUnreadMessagesCount() {
    fetch('/api/unread-count') // Update with the correct endpoint for unread message count
        .then(response => response.json())
        .then(data => {
            const unreadCountElement = document.getElementById('unreadCount');
            if (data.unreadCount > 0) {
                unreadCountElement.textContent = data.unreadCount;
                unreadCountElement.style.display = 'inline-block';
            } else {
                unreadCountElement.style.display = 'none';
            }
        })
        .catch(error => console.error('Error fetching unread messages count:', error));
}

// Initialize
document.addEventListener('DOMContentLoaded', () => {
    fetchUnreadMessagesCount(); // Fetch unread count on page load

    // Optionally, refresh the count periodically (e.g., every 30 seconds)
    setInterval(fetchUnreadMessagesCount, 30000); // 30 seconds
});

     // Show the loading indicator when the page starts loading
     document.addEventListener('DOMContentLoaded', () => {
        document.getElementById('loadingIndicator').style.display = 'flex';
    });

    // Hide the loading indicator once the page is fully loaded
    window.addEventListener('load', () => {
        document.getElementById('loadingIndicator').style.display = 'none';
    });

  </script>
  <style>
    /* Modal styles */
    .modal {
      display: none;
      position: fixed;
      z-index: 1;
      left: 0;
      top: 0;
      width: 100%;
      height: 100%;
      overflow: auto;
      background-color: rgb(0,0,0);
      background-color: rgba(0,0,0,0.4);
      padding-top: 60px;
    }
    .modal-content {
      background-color: #fefefe;
      margin: 5% auto;
      padding: 20px;
      border: 1px solid #888;
      width: 80%;
    }
    .close {
      color: #aaa;
      float: right;
      font-size: 28px;
      font-weight: bold;
    }
    .close:hover,
    .close:focus {
      color: black;
      text-decoration: none;
      cursor: pointer;
    }
    .loading-container {
    display: flex;
    justify-content: center;
    align-items: center;
    height: 100vh;
    background-color: rgba(255, 255, 255, 0.8);
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    z-index: 999;
}
.loading-logo {
    width: 50px;
    height: 50px;
    animation: spin 1s linear infinite;
}
@keyframes spin {
    0% { transform: rotate(0deg); }
    100% { transform: rotate(360deg); }
}


  </style>
</body>
</html>


